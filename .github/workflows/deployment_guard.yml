name: Deployment Guard

on:
  workflow_call:
    outputs:
      allow:
        description: "Whether deployment is allowed"
        value: ${{ jobs.check.outputs.allow }}

jobs:
  check:
    runs-on: ubuntu-latest
    outputs:
      allow: ${{ steps.guard-check.outputs.allow }}
    steps:
      - id: guard-check
        run: |
          # Read org variable
          DEPLOY_VAR="${{ vars.allow_deployment }}"

          # Normalize: lowercase for safety
          DEPLOY_VAR_LOWER=$(echo "$DEPLOY_VAR" | tr '[:upper:]' '[:lower:]')

          # Determine if deployment is allowed
          if [ -z "$DEPLOY_VAR_LOWER" ] || [ "$DEPLOY_VAR_LOWER" = "true" ]; then
            echo "allow=true" >> "$GITHUB_OUTPUT"
          else
            echo "allow=false" >> "$GITHUB_OUTPUT"
          fi
